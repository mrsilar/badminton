<!doctype html>
<html class="no-js">
<head>
 <link rel="stylesheet" href="/assets/css/bootstrap.min.css">
{template h5/common/header}
 <style type="text/css">
  ul,li{
   margin:0;
   padding:0;
  }
  li{
   display:inline;
   list-style:none;
   list-style-position:outside;
   text-align:center;
   font-weight:bold;
   float:left;
  }
  .list{
   line-height:20px;
   text-align:left;
   padding:4px;
   font-weight:normal;
  }
  .menu1{
   width:120px;
   height:auto;
   /*margin:6px 4px 0px 0px;*/
   border:1px solid #eeeeee;
   background-color:#eeeeee;
   /*color:#336601;*/
   padding:6px 0px 0px 0px;
   cursor:hand;
   overflow-y:hidden;
   filter:Alpha(opacity=70);
   -moz-opacity:0.7;
  }
  .menu2{
   width:120px;
   height:36px;
   /*margin:6px 4px 0px 0px;*/
   background-color:#eeeeee;
   /*color:#999999;*/
   border:1px solid #eeeeee;
   padding:6px 0px 0px 0px;
   overflow-y:hidden;
   cursor:hand;
  }
  #nav1{
   /*width:200px;*/
   height:30px;
   border-bottom:0px;
   padding:0px 5px;
   position:relative;
   z-index:1;
   float: right;
   /*left: 240px;*/
   /*top: 53px;*/
  }
  #nav2{
   /*width:200px;*/
   height:30px;
   border-bottom:0px;
   padding:0px 5px;
   position:relative;
   z-index:1;
   /*left: 240px;*/
   float: right;
   /*top: 263px;*/
  }
 </style>
</head>
<header data-am-widget="header" class="am-header am-header-default">
<div class="am-header-left am-header-nav">
<div align="center"><a href="javascript:history.go(-1)" class="">
<img src="/assets/images/jtou.png" /> </a></div>
</div>
<h1 align="center" class="am-header-title">队员调整</h1>
</header>
{if $c_a && ($team_match->team_a_mem_id == $user_id || $user_admin == 1 )}
<div>
 {$team_match->team_a_name}
<div id="nav1">
 <ul>
  <li class="menu2" onclick="changeStyle(this);">添加
  <div class="list">
   <button type="button" id="club1_add" class="btn" style="color:#52b2ff; border: solid 1px;float: right;margin-bottom: 5px">
    新增队员报名
   </button>
   <button type="button" id="club1_had_add" class="btn" style="color:#52b2ff; border: solid 1px;float: right">
    添加已有队员
   </button>
  </div>
  </li>
 </ul>
</div>
</div>
<hr data-am-widget="divider" style="" class="am-divider am-divider-default" />
{loop $c_a $v } 
{loop $v['category_list'] $vv}
<div style="float:left;width:50%; height: 30px; border-bottom:1px solid #ddd; text-align:center">
 <!--<a style="color: #52b2ff" href="/h5/member/activity/specail/four/change_member_last?category_member_id={$vv->team_member_match_category_member_id}&type=a&mem_id={$vv->id}&team_match_id={$team_match->id}&team_mem_id={$team_match->team_a_mem_id}">{$vv->name}</a>-->
 <select name="new_list" style="color: #52b2ff;">
  <option value="{$vv->id},{$vv->id},{$vv->team_member_match_category_member_id},a,{$team_match->id}" selected>{$vv->name}</option>
  {loop $person_list_a $vv2 }
  {if $vv2->id != $vv->id}
  <option value="{$vv2->id},{$vv->id},{$vv->team_member_match_category_member_id},a,{$team_match->id}">{$vv2->name}</option>
  {/if}
  {/loop}
 </select>
</div>
{/loop}
 {/loop}
<br>
<br>
<br>
<br>
<br>
<br>
 {/if} 
{if $c_b && ($team_match->team_b_mem_id == $user_id || $user_admin == 1)}
<div>
 {$team_match->team_b_name}
 <!-- Button trigger modal -->
 <div id="nav2">
  <ul>
   <li class="menu2" onclick="changeStyle(this);">添加
    <div class="list">
     <button type="button" id="club2_add" class="btn" style="color:#52b2ff; border: solid 1px;float: right;margin-bottom: 5px">
      新增队员报名
     </button>
     <button type="button" id="club2_had_add" class="btn" style="color:#52b2ff; border: solid 1px;float: right">
      添加已有队员
     </button>
    </div>
   </li>
  </ul>
 </div>
</div>
<hr data-am-widget="divider" style="" class="am-divider am-divider-default" />
{loop $c_b $vi }
 {loop $vi['category_list'] $vivi}
<div style="float:left;width:50%; height: 30px; border-bottom:1px solid #ddd; text-align:center">
 <!--<a style="color: #52b2ff" href="/h5/member/activity/specail/four/change_member_last?category_member_id={$vivi->team_member_match_category_member_id}&type=b&mem_id={$vivi->id}&team_match_id={$team_match->id}&team_mem_id={$team_match->team_b_mem_id}">{$vivi->name}</a>-->
 <select name="new_list" style="color: #52b2ff;">
  <option value="{$vivi->id},{$vivi->id},{$vivi->team_member_match_category_member_id},b,{$team_match->id}" selected>{$vivi->name}</option>
  {loop $person_list_b $vivi2 }
  {if $vivi2->id != $vivi->id}
  <option value="{$vivi2->id},{$vivi->id},{$vivi->team_member_match_category_member_id},b,{$team_match->id}">{$vivi2->name}</option>
  {/if}
  {/loop}
 </select>
</div>
{/loop}
{/loop}
{/if}
<button type="button" style="border-radius:10px; background:#09C; color:#fff; margin-top:20px; margin-bottom:20px; width:80%; margin-left:10%;" class="am-btn am-btn-default" id="reset_team">提交</button>
<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
 <div class="modal-dialog" role="document">
  <div class="modal-content">
   <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
    <h4 class="modal-title" id="myModalLabel">添加队员</h4>
   </div>
   <div class="modal-body">
    <form>
     <input type="hidden"  name="team_match_id" value="{$team_match->id}">
     <input type="hidden"  name="type" value="{$type}">
     <input type="hidden"  name="team_mem_id" value="{$team_match->team_b_mem_id}">

     <div class="form-group">
      <label for="name" class="control-label">姓名(*)</label>
      <input type="text" id="name" name="name" class="form-control noborder"  placeholder="输入你的姓名">
     </div>
     <div class="form-group">
      <label for="phone_number" class="control-label">手机号(*)</label>
      <input type="text" id="phone_number" name="phone_number" class="form-control noborder"  placeholder="输入你的手机号码">
     </div>
     <div class="form-group">
      <label for="identity_card" class="control-label">身份证</label>
      <input type="text" id="identity_card" name="identity_card" class="form-control noborder"  placeholder="输入你的身份证">
     </div>
     <div class="form-group">
      <label class="control-label">性别</label>
      <label class="radio-inline">
       <input type="radio" name="sex" value="1" checked> 男
      </label>
      <label class="radio-inline">
       <input type="radio" name="sex" value="2"> 女
      </label>
     </div>
    </form>
   </div>
   <div class="modal-footer">
    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
    <button type="button" class="btn btn-primary" id="add_member">添加</button>
   </div>
  </div>
 </div>
</div>


<!-- Modal -->
<div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
 <div class="modal-dialog" role="document">
  <div class="modal-content">
   <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
    <h4 class="modal-title" id="myModalLabel2">添加队员</h4>
   </div>
   <div class="modal-body">
    <input type="hidden"  name="mem_id" id="mem_id">
    <input type="hidden"  name="type" id="type">
    <form id="p_list">
    </form>
   </div>
   <div class="modal-footer">
    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
    <button type="button" class="btn btn-primary" id="add_member2">添加</button>
   </div>
  </div>
 </div>
</div>
{template h5/common/footer}
<script src="/assets/js/jquery.min.js"></script>
<script type="text/javascript" src="/assets/js/jquery.cookie.js"></script>
<script src="/assets/js/amazeui.min.js"></script>
<script src="/assets/js/bootstrap.min.js"></script>
<script type="text/javascript">
 $("#reset_team").click(function() {
  if (confirm("确认修改对阵？")) {
   var tmp=[];
   var person_id=[]; //替换id
   var mem_id=[]; //被替换的id
   var team_match_id=[];
   var category_member_id=[];
   var type=[];

   $("select[name='new_list']").each( function(){
     tmp = $(this).val().split(',');
     person_id.push(tmp[0]);
     mem_id.push(tmp[1]);
     category_member_id.push(tmp[2]);
     type.push(tmp[3]);
     team_match_id.push(tmp[4]);
   });

   console.log(person_id);

   $.ajax({
    type: "post",
    url: "/h5/member/activity/specail/four/change_member_last",
    data: {
     person_id:person_id,
     mem_id:mem_id,
     category_member_id:category_member_id,
     type:type,
     team_match_id:team_match_id
    },
    dataType: "json",
    success: function(data){
      if (data.code == 0 && data.msg == 'ok') {
       //修改成功
       alert("修改成功");
       window.location.reload();
      } else {
       alert("修改失败！"+data.msg);
      }
    },
    error: function() {
     alert("网络错误，请稍后再试");
    }
   });
  }
 });

 $("#club1_add").click(function() {
  $('input[name="type"]').val('a');
  $('input[name="team_mem_id"]').val('{$team_match->team_a_mem_id}');
  $('#myModal').modal('show');
 });

 $("#club2_add").click(function() {
  $('input[name="type"]').val('b');
  $('input[name="team_mem_id"]').val('{$team_match->team_b_mem_id}');
  $('#myModal').modal('show');
 });

 $("#add_member").click(function() {
  $.ajax({
   type: "post",
   url: "/h5/member/activity/specail/four/add_member",
   data: {
    team_match_id:$("input[name='team_match_id']").val(),
    type:$("input[name='type']").val(),
    team_mem_id:$("input[name='team_mem_id']").val(),
    name:$("input[name='name']").val(),
    phone_number:$("input[name='phone_number']").val(),
    identity_card:$("input[name='identity_card']").val(),
    sex:$("input[name='sex']").val()
   },
   dataType: "json",
   success: function(data){
    if (data.code == 0 && data.msg == 'ok') {
     //修改成功
     alert("添加成功");
     $('#myModal').modal('hide');
     window.location.reload();
    } else {
     alert("添加失败！"+data.msg);
    }
   },
   error: function() {
    alert("网络错误，请稍后再试");
   }
  });
 });

 $("#club1_had_add").click(function() {
  $.ajax({
   type: "post",
   url: "/h5/club/person_ingame",
   data: {
    mem_id:"{$team_match->team_a_mem_id}",
    type:"a",
    team_match_id:"{$team_match->id}"
   },
   dataType: "json",
   success: function(data){
    if (data.code == 0 && data.msg == 'ok') {
     //获取list成功
     //填数据
     $("#mem_id").val("{$team_match->team_a_mem_id}");
     $("#type").val("a");
     var person_list = data.list;
     $("#p_list").empty();
     $("#add_member2").show();
     for (var i = 0; i < person_list.length; ++i) {
      $("#p_list").append('<div class="checkbox">'+
      '<label>'+
      '<input type="checkbox" name="person_list" value="'+person_list[i]['id']+'">'+person_list[i]['name']+
      '</label>'+
      '</div>');
     }
     if (person_list.length == 0) {
      $("#p_list").append("暂无可添加的队员");
      $("#add_member2").hide();
     }
     $('#myModal2').modal('show');
    } else {
     alert("获取名单失败！"+data.msg);
    }
   },
   error: function() {
    alert("网络错误，请稍后再试");
   }
  });

 });

 $("#club2_had_add").click(function() {
  $.ajax({
   type: "post",
   url: "/h5/club/person_ingame",
   data: {
    mem_id:"{$team_match->team_b_mem_id}",
    type:"b",
    team_match_id:"{$team_match->id}"
   },
   dataType: "json",
   success: function(data){
    if (data.code == 0 && data.msg == 'ok') {
     //获取list成功
     //填数据
     $("#mem_id").val("{$team_match->team_b_mem_id}");
     $("#type").val("b");
     var person_list = data.list;
     $("#p_list").empty();
     $("#add_member2").show();
     for (var i = 0; i < person_list.length; ++i) {
      $("#p_list").append('<div class="checkbox">'+
      '<label>'+
      '<input type="checkbox" name="person_list" value="'+person_list[i]['id']+'">'+person_list[i]['name']+
      '</label>'+
      '</div>');
     }
     if (person_list.length == 0) {
      $("#p_list").append("暂无可添加的队员");
      $("#add_member2").hide();
     }
     $('#myModal2').modal('show');
    } else {
     alert("获取名单失败！"+data.msg);
    }
   },
   error: function() {
    alert("网络错误，请稍后再试");
   }
  });
 });

 $("#add_member2").click(function() {
  var person_list=[];
  $("input[name='person_list']:checked").each(function(){
   person_list.push($(this).val());
  });

  $.ajax({
   type: "post",
   url: "/h5/club/person_ingame_add",
   data: {
    mem_id:$("#mem_id").val(),
    type:$("#type").val(),
    team_match_id:"{$team_match->id}",
    person_list:person_list
   },
   dataType: "json",
   success: function(data){
    if (data.code == 0 && data.msg == 'ok') {
     //修改成功
     alert("添加成功");
     $('#myModal2').modal('hide');
     window.location.reload();
    } else {
     alert("添加失败！"+data.msg);
    }
   },
   error: function() {
    alert("网络错误，请稍后再试");
   }
  });

 });

 function changeStyle(ele) {
//  console.log($(ele).attr('class'));
  if ($(ele).attr('class') == 'menu1') {
   $(ele).attr('class','menu2');
  } else {
   $(ele).attr('class','menu1')
  }
 }

</script>
</body>
</html>
